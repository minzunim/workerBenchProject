<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Document</title>
  </head>
  <style>
    img {
      border: none;
    }
    .img-test-wrap {
      width: 1000px;
      height: 800px;
      border: 2px solid black;
      margin-left: 30px;
      margin-top: 30px;
    }
    #thumb-img-wrap {
      width: 400px;
      height: 350px;
      margin: auto;
      border: 2px solid rgb(28, 97, 188);
      margin-top: 10px;
    }
    #thumb-img-show {
      display: block;
      max-width: 350px;
      width: 350px;
      margin: auto;
      margin-bottom: 5px;
      border: none;
    }
    #more-img-wrap {
      display: flex;
      margin-top: 30px;
    }
    .sub-img-class {
      display: block;
      max-width: 330px;
      width: 330px;
    }
    .text-wrap {
      margin: 10px 0 10px 10px;
    }
    #text-input-1,
    #text-input-2 {
      width: 200px;
      height: 30px;
      border: 3px solid rgb(74, 16, 127);
    }
    #submit-btn-wrap > button {
      width: 100px;
      height: 40px;
      font-size: 20px;
      margin: 10px 0 0 30px;
    }
  </style>
  <body>
    <div class="img-test-wrap">
      <div class="text-wrap">
        <input
          id="text-input-1"
          type="text"
          placeholder="내용을 입력해 주세요"
        />
        <input
          id="text-input-2"
          type="text"
          placeholder="내용을 입력해 주세요"
        />
      </div>
      <div id="thumb-img-wrap">
        <img id="thumb-img-show" />
        <input type="file" accept="image/*" , id="thumb-img-file" />
      </div>
      <div id="more-img-wrap">
        <div class="sub-imgs-wrap">
          <img class="sub-img-class" id="sub-img-1" />
          <input type="file" accept="image/*" , class="sub-img-file" />
        </div>
        <div class="sub-imgs-wrap">
          <img class="sub-img-class" id="sub-img-2" />
          <input type="file" accept="image/*" , class="sub-img-file" />
        </div>
        <div class="sub-imgs-wrap">
          <img class="sub-img-class" id="sub-img-3" />
          <input type="file" accept="image/*" , class="sub-img-file" />
        </div>
      </div>
    </div>
    <div id="submit-btn-wrap">
      <button onclick="submitContent()">전송하기</button>
    </div>

    <script>
      $(document).ready(function () {
        const thumbImg = document.querySelector('#thumb-img-file');
        thumbImg.addEventListener('change', function (event) {
          let files = event.target.files;
          if (files.length >= 1) {
            const imgShow = document.querySelector('#thumb-img-show');
            const reader = new FileReader();
            reader.addEventListener('load', function (event) {
              imgShow.src = reader.result;
            });
            reader.readAsDataURL(files[0]);
          }
          if (!files.length) {
            const imgShow = document.querySelector(`#thumb-img-show`);
            imgShow.removeAttribute('src');
          }
        });

        const imgSel = document.querySelectorAll('.sub-img-file');
        for (let i = 1; i <= imgSel.length; i++) {
          imgSel[i - 1].addEventListener('change', function (event) {
            let files = event.target.files;

            if (files.length >= 1) {
              insertImageDate(i, files[0]);
            }

            if (!files.length) {
              const imgShow = document.querySelector(`#sub-img-${i}`);
              imgShow.removeAttribute('src');
            }
          });
        }

        async function insertImageDate(imgNum, file) {
          const imgShow = document.querySelector(`#sub-img-${imgNum}`);

          const reader = new FileReader();

          reader.addEventListener('load', function (event) {
            imgShow.src = reader.result;
          });
          reader.readAsDataURL(file);
        }
      });

      const submitContent = async () => {
        if (document.querySelector('#thumb-img-file').files.length < 1) {
          alert('썸네일 사진을 등록해 주세요!');
          return;
        }

        // 워크샵에 대한 원시값 데이터들
        const jsonData = {
          title: '테스트용 워크샵1',
          category: 'offline',
          desc: '워크샵에 대한 설명 입니다. 1',
          min_member: 5,
          max_member: 20,
          total_time: 200,
          price: 30000,
          location: '서울 경기권 위주로 가능합니다.',
        };
        // 썸네일 이미지 파일
        const thumbImg = document.querySelector('#thumb-img-file').files[0];
        // 서브 이미지 태그 묶음 -> 파일 배열
        const subImgsTags = document.querySelectorAll('.sub-img-file');

        const formData = new FormData();
        formData.append('images', thumbImg);
        formData.append('jsonData', JSON.stringify(jsonData));

        for (let i = 1; i <= subImgsTags.length; i++) {
          const imgFile = subImgsTags[i - 1].files;
          if (imgFile.length >= 1) {
            formData.append('images', imgFile[0]);
          }
        }

        $.ajax({
          type: 'POST',
          enctype: 'multipart/form-data',
          url: '/api/auth/img-s3-test',
          data: formData,
          processData: false,
          contentType: false,
          cache: false,
          success: function (response) {
            console.log('okay~~~~');
          },
          error: function (request, status, error) {
            console.log(
              `${request.status} ${error} / ${request.responseJSON.msg}`,
            );
          },
        });
      };
    </script>
  </body>
</html>
